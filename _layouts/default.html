<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}" data-theme="">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    {% seo %}

    <!-- Set theme BEFORE paint to avoid flash -->
    <script>
      (function () {
        try {
          var stored = localStorage.getItem('theme');
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          var theme = stored || (prefersDark ? 'dark' : 'light');
          document.documentElement.setAttribute('data-theme', theme);
        } catch (e) {}
      })();
    </script>

    <!-- Minima core -->
    <link
      rel="stylesheet"
      href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}"
    />
    <!-- Your overrides (cache-busted) -->
    <link
      rel="stylesheet"
      href="{{ '/assets/css/custom.css' | relative_url }}?v={{ site.github.build_revision }}"
    />
  </head>
  <body>
    <!-- ===== Header ===== -->
    <header class="site-header" role="banner" aria-label="Site header">
      <div class="wrapper" style="display:flex;align-items:center;gap:1rem;justify-content:space-between;">
        <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
        <!-- Optional: simple theme toggle -->
        <button id="themeToggle" class="theme-btn" type="button" aria-label="Toggle theme">ðŸŒ“</button>
      </div>
    </header>

    <!-- ===== Main ===== -->
    <main class="page-content" aria-label="Main content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    <!-- ===== Footer ===== -->
    <footer class="site-footer h-card" role="contentinfo" aria-label="Site footer">
      <div class="wrapper">
        <div style="text-align:center;width:100%">
          Â© {{ site.time | date: "%Y" }} Mason Colborn
        </div>
      </div>
    </footer>

    <!-- Minima scale fix (optional) -->
    <script src="{{ '/assets/js/scale.fix.js' | relative_url }}"></script>

    <!-- Theme toggle -->
    <script>
      (function () {
        var btn = document.getElementById('themeToggle');
        function cur() { return document.documentElement.getAttribute('data-theme') || 'light'; }
        function apply(t) {
          document.documentElement.setAttribute('data-theme', t);
          try { localStorage.setItem('theme', t); } catch (e) {}
        }
        if (btn) btn.addEventListener('click', function () { apply(cur() === 'dark' ? 'light' : 'dark'); });

        // Follow system changes if no manual choice yet
        try {
          var stored = localStorage.getItem('theme');
          if (!stored && window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)')
              .addEventListener('change', function (e) { apply(e.matches ? 'dark' : 'light'); });
          }
        } catch (e) {}
      })();
    </script>

    <!-- Tabs deep-linking (TV/Sports) + ARIA state -->
    <script>
      (function () {
        // Guard so this runs harmlessly on pages without tabs
        var tvRadio = document.getElementById('tab-tv');
        var spRadio = document.getElementById('tab-sports');
        var tvLabel = document.querySelector('label[for="tab-tv"]');
        var spLabel = document.querySelector('label[for="tab-sports"]');
        if (!tvRadio || !spRadio) return;

        function updateAria () {
          var tvOn = tvRadio.checked;
          if (tvLabel) {
            tvLabel.setAttribute('role', 'tab');
            tvLabel.setAttribute('aria-selected', tvOn ? 'true' : 'false');
            tvLabel.setAttribute('tabindex', tvOn ? '0' : '-1');
          }
          if (spLabel) {
            spLabel.setAttribute('role', 'tab');
            spLabel.setAttribute('aria-selected', tvOn ? 'false' : 'true');
            spLabel.setAttribute('tabindex', tvOn ? '-1' : '0');
          }
        }

        function selectFromHash () {
          if (location.hash === '#sports') { spRadio.checked = true; }
          else { tvRadio.checked = true; } // default to TV
          updateAria();
        }

        // Open correct panel on load and when the hash changes
        selectFromHash();
        window.addEventListener('hashchange', selectFromHash);

        // Update the URL hash when a tab is clicked so itâ€™s shareable/bookmarkable
        if (tvLabel) tvLabel.addEventListener('click', function () { history.replaceState(null, '', '#tv'); updateAria(); });
        if (spLabel) spLabel.addEventListener('click', function () { history.replaceState(null, '', '#sports'); updateAria(); });
      })();
    </script>
  </body>
</html>
